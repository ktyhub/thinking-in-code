# 什么是seata

[https://seata.apache.org/docs/next/overview/what-is-seata](https://seata.apache.org/docs/next/overview/what-is-seata)

| **类别**       | **词条**                      | **详细说明**                                                                                |
|--------------|-----------------------------|-----------------------------------------------------------------------------------------|
| **分布式事务模型**  | Seata                       | Apache Seata 是一个开源的分布式事务解决方案，提供高性能、易用的分布式事务服务，支持AT、TCC、Saga和XA四种事务模型。                   |
|              | AT模式（Automatic Transaction） | 基于支持本地ACID事务的关系型数据库，通过两阶段提交协议实现分布式事务，自动生成回滚日志并异步清理。                                     |
|              | TCC模式（Try-Confirm-Cancel）   | 不依赖底层数据资源的事务支持，通过自定义的Prepare、Commit、Rollback逻辑实现分布式事务管理。                                |
|              | Saga模式                      | 长事务解决方案，通过正向服务（提交本地事务）和补偿服务（失败时回滚）实现业务一致性，适用于跨系统或遗留系统的长流程场景。                            |
| **事务机制**     | 两阶段提交协议（2PC）                | AT模式的核心机制，分为两个阶段：<br>1. **阶段一**：提交业务数据及回滚日志，释放本地锁和连接资源；<br>2. **阶段二**：异步提交或基于回滚日志补偿。    |
|              | 全局锁（Global Lock）            | 在AT模式中，本地事务提交前必须获取全局锁，确保数据一致性。若获取失败，事务会重试或超时回滚。                                         |
| **隔离机制**     | 写隔离（Write Isolation）        | 通过全局锁避免脏写问题。在事务提交前获取全局锁，其他事务需等待锁释放后才能继续操作。                                              |
|              | 读隔离（Read Isolation）         | 默认全局事务隔离级别为“读未提交”，通过`SELECT FOR UPDATE`语句实现“读已提交”级别，查询时会申请全局锁并阻塞直到锁释放。                  |
| **数据操作**     | Before Image                | 更新前的数据镜像，用于生成回滚日志和补偿操作。                                                                 |
|              | After Image                 | 更新后的数据镜像，与Before Image共同构成回滚日志，用于数据校验和补偿。                                               |
|              | UNDO_LOG表                   | 存储事务回滚信息的表，结构包含分支事务ID（`branch_id`）、全局事务ID（`xid`）、回滚数据（`rollback_info`）等字段，用于事务失败时的数据恢复。 |
| **核心流程**     | 阶段一（Phase 1）                | 解析SQL、生成Before/After Image、插入UNDO_LOG、申请全局锁并提交本地事务。                                     |
|              | 阶段二（Phase 2）                | 分为两种情况：<br>1. **回滚**：校验数据一致性，生成反向SQL并提交本地事务；<br>2. **提交**：异步删除UNDO_LOG。                 |
| **Saga模式特性** | 正向服务                        | Saga参与者提交本地事务，若后续参与者失败，触发已提交参与者的补偿操作。                                                   |
|              | 补偿服务                        | 自定义的回滚逻辑，用于回滚正向服务的操作。                                                                   |
|              | 优点                          | 无锁、高性能、支持异步执行和高吞吐量，适用于长流程和跨系统场景。                                                        |
|              | 缺点                          | 缺乏隔离性，可能出现脏读或中间状态暴露。                                                                    |
| **技术依赖**     | 关系型数据库                      | AT模式要求数据库支持本地ACID事务（如MySQL）。                                                            |
|              | SELECT FOR UPDATE           | 用于实现全局事务的“读已提交”隔离级别，执行时会申请全局锁并阻塞其他事务。                                                   |
| **其他概念**     | 分支事务（Branch Transaction）    | 全局事务的组成部分，每个分支事务需满足两阶段提交模型（如AT或TCC模式）。                                                  |
|              | 本地事务                        | 单个数据库实例上的ACID事务，AT模式通过本地事务提交业务数据和UNDO_LOG。                                              |

---

### **总结**

Apache Seata 是一个支持多模型的分布式事务框架，其核心机制包括 **AT模式**（基于两阶段提交和全局锁实现数据一致性）、**TCC模式
**（通过自定义Prepare/Commit/Rollback逻辑管理事务）、**Saga模式**（适用于长流程的无锁异步事务）。关键技术点包括：

1. **隔离机制**：通过全局锁和`SELECT FOR UPDATE`实现写隔离和读隔离；
2. **数据回滚**：利用Before/After Image生成UNDO_LOG，支持事务失败时的自动补偿；
3. **适用场景**：AT模式适合强一致性场景，TCC适用于自定义事务逻辑，Saga适用于跨系统长流程。  
   Seata通过灵活的事务模型和底层优化，解决了分布式系统中的数据一致性问题，同时平衡了性能与复杂度。