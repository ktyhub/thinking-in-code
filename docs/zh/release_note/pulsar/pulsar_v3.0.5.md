# pulsar v3.0.5

### Broker

- [修复][broker] 修复强制删除订阅无效的问题 ([#22423](https://github.com/apache/pulsar/pull/22423))
- [修复][broker] 避免在使用可扩展负载管理器关闭 broker 时卡住 ([#22573](https://github.com/apache/pulsar/pull/22573))
- [修复][broker] 在当前账本关闭后创建新账本 ([#22034](https://github.com/apache/pulsar/pull/22034))
- [修复][broker] 禁用系统主题消息去重 ([#22582](https://github.com/apache/pulsar/pull/22582))
- [修复][broker] 修复 /metrics gzip 压缩中的 BufferOverflowException 和 EOFException 错误 ([#22576](https://github.com/apache/pulsar/pull/22576))
- [修复][broker] 修复在使用 Key_Shared 模式且 allowOutOfOrderDelivery=true 时导致分发停止的 NPE ([#22533](https://github.com/apache/pulsar/pull/22533))
- [修复][broker] 修复非持久主题上由于 userCreatedProducerCount 错误导致的 ProducerBusy 问题 ([#22685](https://github.com/apache/pulsar/pull/22685))
- [修复][broker] 修复在 NamespaceEventsSystemTopicFactory 初始化期间 SystemTopicBasedTopicPoliciesService 中的死锁 ([#22528](https://github.com/apache/pulsar/pull/22528))
- [修复][broker] 修复与旧版 pulsar 不兼容的主题策略实现 ([#22535](https://github.com/apache/pulsar/pull/22535))
- [修复][broker] 修复 configurationMetadataSyncEventTopic 被标记为支持动态设置但未实现的问题 ([#22684](https://github.com/apache/pulsar/pull/22684))
- [修复][broker] 修复在处理大量积压时消费者停止接收消息的问题 ([#22454](https://github.com/apache/pulsar/pull/22454))
- [修复][broker] 修复记录异常日志时的无效条件 ([#22412](https://github.com/apache/pulsar/pull/22412))
- [修复][broker] 修复生产者统计中的消息丢弃记录 ([#22458](https://github.com/apache/pulsar/pull/22458))
- [修复][broker] 修复加载非持久主题失败时 pulsar_topic_load_failed_count 为 0 的问题，并修复不稳定的测试 testBrokerStatsTopicLoadFailed ([#22580](https://github.com/apache/pulsar/pull/22580))
- [修复][broker] 修复移除动态配置后无变化的问题 ([#22673](https://github.com/apache/pulsar/pull/22673))
- [修复][broker] 修复 Consumer 类中的拼写错误 ([#22532](https://github.com/apache/pulsar/pull/22532))
- [修复][broker] 修复拼写错误 lister -> listener ([#21068](https://github.com/apache/pulsar/pull/21068))
- [修复][broker] 一个主题可以同时多次关闭 ([#17524](https://github.com/apache/pulsar/pull/17524))
- [修复][broker] 优化 /metrics，修复无界请求队列问题并修复 metricsBufferResponse 模式中的竞争条件 ([#22494](https://github.com/apache/pulsar/pull/22494))
- [修复][broker] 第1部分：由于前一个主题所有者中的孤立复制器，复制器无法成功创建 ([#21946](https://github.com/apache/pulsar/pull/21946))
- [修复][broker] 第2部分：由于前一个主题所有者中的孤立复制器，复制器无法成功创建 ([#21948](https://github.com/apache/pulsar/pull/21948))
- [修复][broker] 防止长时间去重游标积压，以免主题加载超时 ([#22479](https://github.com/apache/pulsar/pull/22479))
- [修复][broker] 启用 replicateSubscriptionState 后，调用 hasMessageAvailable 时 Reader 卡住 ([#22572](https://github.com/apache/pulsar/pull/22572))
- [修复][broker] 在卸载期间，如果主题未来失败并进行所有权检查，则跳过 topic.close，并修复 isBundleOwnedByAnyBroker 以使用 ns.checkOwnershipPresentAsync 进行 ExtensibleLoadBalancer ([#22379](https://github.com/apache/pulsar/pull/22379)) ([#22403](https://github.com/apache/pulsar/pull/22403))
- [修复][broker] 支持没有在密钥中设置 alg 字段的 OIDC 提供商 ([#22421](https://github.com/apache/pulsar/pull/22421))
- [修复][broker] 更新 TransferShedder 未加载 broker 检查以考虑最大加载 broker 的 msgThroughputEMA，并更新 IsExtensibleLoadBalancerImpl 检查 ([#22321](https://github.com/apache/pulsar/pull/22321)) ([#22416](https://github.com/apache/pulsar/pull/22416))
- [修复][broker] 当配置 maxNumPartitionsPerPartitionedTopic<0 时更新主题分区失败 ([#22397](https://github.com/apache/pulsar/pull/22397))
- [修复][broker] 避免卸载系统主题 ([#22497](https://github.com/apache/pulsar/pull/22497))
- [修复][broker] 修复事务消息的复制订阅 ([#22452](https://github.com/apache/pulsar/pull/22452))
- [修复][broker] 重命名为 changeMaxReadPositionCount ([#22656](https://github.com/apache/pulsar/pull/22656))
- [修复][broker] usedLocallySinceLastReport 应始终重置 ([#22672](https://github.com/apache/pulsar/pull/22672))
- [修复][broker][admin] 修复无法更新非持久订阅的属性 ([#22411](https://github.com/apache/pulsar/pull/22411))
- [修复][broker] 修复 Reader 可能因事务中止消息而卡住 ([#22610](https://github.com/apache/pulsar/pull/22610))
- [改进][broker] 使配置 `metricsBufferResponse` 的描述更有效 ([#22490](https://github.com/apache/pulsar/pull/22490))
- [改进][broker] 在错误后重试重新验证 ResourceLock 并进行退避 ([#22617](https://github.com/apache/pulsar/pull/22617))
- [改进][broker] 添加 `topic_load_failed` 指标 ([#19236](https://github.com/apache/pulsar/pull/19236))
- [改进][broker] 将主题名称添加到发出的错误消息中 ([#22506](https://github.com/apache/pulsar/pull/22506))
- [改进][broker] 在使用 Key_Shared 模式时避免重复读取和丢弃 ([#22245](https://github.com/apache/pulsar/pull/22245))
- [改进][broker] 启用主题级别复制时自动创建分区主题 ([#22537](https://github.com/apache/pulsar/pull/22537))
- [改进][broker] 默认情况下不记录 brokerClientAuthenticationParameters 和 bookkeeperClientAuthenticationParameters ([#22395](https://github.com/apache/pulsar/pull/22395))
- [改进][broker] 改进 Gzip 压缩，允许排除特定路径或禁用它 ([#22370](https://github.com/apache/pulsar/pull/22370))
- [改进][broker] 通过共享/缓存压缩结果优化 /metrics 端点的 gzip 压缩 ([#22521](https://github.com/apache/pulsar/pull/22521))
- [改进][broker] 在适用时在 TopicBusyException 中传播原因异常 ([#22596](https://github.com/apache/pulsar/pull/22596))
- [改进][broker] 当 configurationMetadataStore 等于 localMetadataStore 时重复 handleMetadataChanges 回调 ([#22519](https://github.com/apache/pulsar/pull/22519))
- [改进][broker] Servlet 支持响应压缩 ([#21667](https://github.com/apache/pulsar/pull/21667))
- [改进][broker] 支持 X-Forwarded-For 和 HA Proxy 协议以解析 http/https 请求的原始客户端 IP ([#22524](https://github.com/apache/pulsar/pull/22524))
- [改进][broker] 积压配额超限日志替换为 `debug` ([#22488](https://github.com/apache/pulsar/pull/22488))
- [修复][ml] 修复在恢复终止的托管账本时 getValidPositionAfterSkippedEntries 的 NPE ([#22552](https://github.com/apache/pulsar/pull/22552))
- [修复][ml] 标记由于