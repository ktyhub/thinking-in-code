# pulsar v3.1.3

### Broker

- [improve][broker] 一致性地为 REST API 添加细粒度授权 [#22202](https://github.com/apache/pulsar/pull/22202)
- [improve][broker] 为保留管理 API 添加细粒度授权 [#22163](https://github.com/apache/pulsar/pull/22163)
- [improve][broker] 缓存发送到系统主题的内部写入器 [#22099](https://github.com/apache/pulsar/pull/22099)
- [improve][broker] 添加错误日志以排查启动代理注册表失败的问题 [#22065](https://github.com/apache/pulsar/pull/22065)
- [improve][broker] 不在系统主题中保留数据 [#22022](https://github.com/apache/pulsar/pull/22022)
- [improve][broker] 当主题元数据不存在且不期望创建新元数据时，不尝试打开 ML [#21995](https://github.com/apache/pulsar/pull/21995) [#22004](https://github.com/apache/pulsar/pull/22004)
- [improve][broker] 当调用 Admin API 并且主题不存在时，不打印错误日志 [#21995](https://github.com/apache/pulsar/pull/21995)
- [improve][broker] 当查找因 LockBusyException 失败时，不关闭套接字 [#21993](https://github.com/apache/pulsar/pull/21993)
- [improve][broker] 不基于不活动滚动空账本 [#21893](https://github.com/apache/pulsar/pull/21893)
- [improve][broker] 改进 NamespaceUnloadStrategy 错误消息 [#21880](https://github.com/apache/pulsar/pull/21880)
- [improve][broker] 如果未配置，则跳过加载 NAR 包 [#21867](https://github.com/apache/pulsar/pull/21867)
- [improve][broker] 如果所有者不活动，则推迟所有权检查 (ExtensibleLoadManager) [#21811](https://github.com/apache/pulsar/pull/21811)
- [improve][broker] 在撤销订阅权限时清理 zk 中的空 subscriptionAuthenticationMap [#21696](https://github.com/apache/pulsar/pull/21696)
- [improve][broker] 当捆绑卸载或元数据异常导致查找失败时，不关闭套接字 [#21211](https://github.com/apache/pulsar/pull/21211)
- [fix][broker][branch-3.1] 修复在启用事务和可扩展负载管理器时代理无法启动的问题 [#22194](https://github.com/apache/pulsar/pull/22194)
- [fix][broker] 删除分区主题失败时不打印日志 [#22153](https://github.com/apache/pulsar/pull/22153)
- [fix][broker] 在分配和释放时不等待源代理并处理角色初始化期间的角色更改 [#22112](https://github.com/apache/pulsar/pull/22112)
- [fix][broker] 启用批处理导致由于确认和交付并发导致的负未确认消息 [#22090](https://github.com/apache/pulsar/pull/22090)
- [fix][broker] 支持使用 gid != 0 运行 Docker 容器 [#22081](https://github.com/apache/pulsar/pull/22081)
- [fix][broker] 显式设置 ServiceUnitStateChannel 主题压缩阈值，改进 getOwnerAsync，并修复其他错误 [#22064](https://github.com/apache/pulsar/pull/22064)
- [fix][broker] 修复使用以数字结尾的消费者名称时的哈希冲突 [#22053](https://github.com/apache/pulsar/pull/22053)
- [fix][broker] 在 apply-config-from-env.py 脚本中记录之前清理值 [#22044](https://github.com/apache/pulsar/pull/22044)
- [fix][broker] 修复无法使用后缀匹配的正则表达式订阅分区主题的问题 [#22025](https://github.com/apache/pulsar/pull/22025)
- [fix][broker] 由于调用 Admin API analyzeSubscriptionBacklog 导致订阅卡住 [#22019](https://github.com/apache/pulsar/pull/22019)
- [fix][broker][branch-3.1] 避免 PublishRateLimiter 使用已关闭的 RateLimiter [#22011](https://github.com/apache/pulsar/pull/22011)
- [fix][broker] 支持动态设置 autoSkipNonRecoverableData 在 expiryMon… [#21991](https://github.com/apache/pulsar/pull/21991)
- [fix][broker] 为健康检查读取添加超时 [#21990](https://github.com/apache/pulsar/pull/21990)
- [fix][broker] 删除分区主题时修复架构删除错误 [#21977](https://github.com/apache/pulsar/pull/21977)
- [fix][broker] 修复从压缩主题读取时读取器卡住的问题 [#21969](https://github.com/apache/pulsar/pull/21969)
- [fix][broker] 由于卸载主题失败导致复制停止 [#21947](https://github.com/apache/pulsar/pull/21947)
- [fix][broker] 根据账本关闭时间过期消息以避免客户端时钟偏差 [#21940](https://github.com/apache/pulsar/pull/21940)
- [fix][broker] 恢复代理 ID 以匹配现有 Pulsar 版本中使用的格式 [#21937](https://github.com/apache/pulsar/pull/21937)
- [fix][broker] 修复 getMessageById 抛出 500 错误 [#21919](https://github.com/apache/pulsar/pull/21919)
- [fix][broker] 修复将所有压缩条目写入压缩主题的问题 [#21917](https://github.com/apache/pulsar/pull/21917)
- [fix][broker] 修复跳过不可恢复账本时的死锁问题 [#21915](https://github.com/apache/pulsar/pull/21915)
- [fix][broker] 修复在配置了广告地址和广告监听器时无法确定领导代理的问题 [#21894](https://github.com/apache/pulsar/pull/21894)
- [fix][broker] 修复由于 PIP-145 的错误导致无法使用后缀匹配的正则表达式订阅分区主题的问题 [#21885](https://github.com/apache/pulsar/pull/21885)
- [fix][broker] 修复压缩/复制数据丢失问题 [#21865](https://github.com/apache/pulsar/pull/21865)
- [fix][broker] 修复 NonPersistentDispatcherMultipleConsumers 的 ArrayIndexOutOfBoundsException [#21856](https://github.com/apache/pulsar/pull/21856)
- [fix][broker] 修复在同时设置 webServicePort 和 webServicePortTls 时返回错误的 webServiceUrl [#21842](https://github.com/apache/pulsar/pull/21842)
- [fix][broker] 修复 TableViewLoadDataStoreImpl 的 NPE [#21777](https://github.com/apache/pulsar/pull/21777)
- [fix][broker] 修复 BrokerService.maxUnackedMsgsPerDispatcher 的错误值 [#21765](https://github.com/apache/pulsar/pull/21765)
- [fix][broker] 修复在领导权变更时 ExtensibleLoadManagerImpl 内部系统获取主题失败的问题 [#21764](https://github.com/apache/pulsar/pull/21764)
- [fix][broker] 删除主题时删除压缩账本 [#21745](https://github.com/apache/pulsar/pull/21745)
- [fix][broker] 跳过 ExtensibleLoadManager 内部主题的自动创建 [#21729](https://github.com/apache/pulsar/pull/21729)
- [fix][broker] 避免压缩任务在最后一条消息是标记时卡住 [#21718](https://github.com/apache/pulsar/pull/21718)
- [fix][broker] 修复可能被删除的主题问题 [#21704](https://github.com/apache/pulsar/pull/21704)
- [fix][broker] 启用 haProxyProtocolEnabled 时网络包丢失 [#21684](https://github.com/apache/pulsar/pull/21684)
- [fix][broker] 修复主题压缩期间的内存泄漏 [#21647](https://github.com/apache/pulsar/pull/21647)
- [fix][broker] 修复查找请求信号量泄漏问题 [#21646](https://github.com/apache/pulsar/pull/21646)
- [fix][broker] 修复在同时设置 webServicePort 和 webServicePortTls 时返回错误的 webServiceUrl [#21633](https://github