# pulsar v3.0.3
```markdown
## 变更内容

### Broker

- **改进**：为REST API一致性地添加细粒度授权 [22202](https://github.com/apache/pulsar/pull/22202)
- **改进**：为保留管理API添加细粒度授权 [22163](https://github.com/apache/pulsar/pull/22163)
- **改进**：在发送到系统主题时缓存内部写入器 [22099](https://github.com/apache/pulsar/pull/22099)
- **改进**：添加错误日志以排查启动Broker注册表失败的问题 [22065](https://github.com/apache/pulsar/pull/22065)
- **改进**：不保留系统主题中的数据 [22022](https://github.com/apache/pulsar/pull/22022)
- **改进**：当主题元数据不存在且不期望创建新主题时，不尝试打开ML [21995](https://github.com/apache/pulsar/pull/21995) [22004](https://github.com/apache/pulsar/pull/22004)
- **改进**：在调用Admin API且主题不存在时，响应HTTP-404时不打印错误日志 [21995](https://github.com/apache/pulsar/pull/21995)
- **改进**：如果由于LockBusyException导致查找失败，不关闭套接字 [21993](https://github.com/apache/pulsar/pull/21993)
- **改进**：基于不活动状态不滚动空账本 [21893](https://github.com/apache/pulsar/pull/21893)
- **改进**：改进NamespaceUnloadStrategy错误消息 [21880](https://github.com/apache/pulsar/pull/21880)
- **改进**：如果未配置，则跳过加载NAR包 [21867](https://github.com/apache/pulsar/pull/21867)
- **改进**：如果所有者不活动，则推迟所有权检查（ExtensibleLoadManager） [21857](https://github.com/apache/pulsar/pull/21857) [21811](https://github.com/apache/pulsar/pull/21811)
- **改进**：撤销订阅权限时清理zk中的空subscriptionAuthenticationMap [21696](https://github.com/apache/pulsar/pull/21696)
- **改进**：如果上一个请求不活动，让生产者第一次请求成功 [21220](https://github.com/apache/pulsar/pull/21220)
- **改进**：在禁用去重时避免记录不活动的生产者 [21193](https://github.com/apache/pulsar/pull/21193)
- **改进**：支持在主题压缩期间不保留空键消息 [21578](https://github.com/apache/pulsar/pull/21578) [21662](https://github.com/apache/pulsar/pull/21662)
- **改进**：如果cursorProperties为空，打印recoverBucketSnapshot日志 [21651](https://github.com/apache/pulsar/pull/21651)
- **改进**：支持在主题压缩期间不保留空键消息 [21578](https://github.com/apache/pulsar/pull/21578)
- **修复**：删除分区主题失败时不打印日志 [22153](https://github.com/apache/pulsar/pull/22153)
- **修复**：修复在启用事务和可扩展负载管理器时Broker无法启动的问题 [22139](https://github.com/apache/pulsar/pull/22139)
- **修复**：在分配和释放时不等待源Broker，返回getOwnerAsync并处理角色初始化期间的角色更改 [22112](https://github.com/apache/pulsar/pull/22112)
- **修复**：启用批处理导致由于确认和交付并发导致的负未确认消息 [22090](https://github.com/apache/pulsar/pull/22090)
- **修复**：支持在gid != 0的情况下运行Docker容器 [22081](https://github.com/apache/pulsar/pull/22081)
- **修复**：显式设置ServiceUnitStateChannel主题压缩阈值，改进getOwnerAsync，并修复其他错误 [22064](https://github.com/apache/pulsar/pull/22064)
- **修复**：修复使用以数字结尾的消费者名称时的哈希冲突 [22053](https://github.com/apache/pulsar/pull/22053)
- **修复**：在apply-config-from-env.py脚本中记录前清理值 [22044](https://github.com/apache/pulsar/pull/22044)
- **修复**：修复无法使用后缀匹配正则表达式订阅分区主题的问题 [22025](https://github.com/apache/pulsar/pull/22025)
- **修复**：由于调用Admin API analyzeSubscriptionBacklog导致订阅卡住 [22019](https://github.com/apache/pulsar/pull/22019)
- **修复**：避免PublishRateLimiter使用已关闭的RateLimiter [22011](https://github.com/apache/pulsar/pull/22011)
- **修复**：快速修复由于错误的topicName导致的无限HTTP调用createSubscriptions [21997](https://github.com/apache/pulsar/pull/21997)
- **修复**：支持在expiryMon中动态设置autoSkipNonRecoverableData [21991](https://github.com/apache/pulsar/pull/21991)
- **修复**：为健康检查读取添加超时 [21990](https://github.com/apache/pulsar/pull/21990)
- **修复**：修复删除具有多个分区和模式的分区主题时的模式删除错误 [21977](https://github.com/apache/pulsar/pull/21977)
- **修复**：修复从压缩主题读取时读取器卡住的问题 [21969](https://github.com/apache/pulsar/pull/21969)
- **修复**：修复由于卸载主题失败导致的复制停止问题 [21947](https://github.com/apache/pulsar/pull/21947)
- **修复**：根据账本关闭时间过期消息以避免客户端时钟偏差 [21940](https://github.com/apache/pulsar/pull/21940)
- **修复**：恢复Broker ID以匹配现有Pulsar版本中使用的格式 [21937](https://github.com/apache/pulsar/pull/21937)
- **修复**：修复getMessageById抛出500错误 [21919](https://github.com/apache/pulsar/pull/21919)
- **修复**：修复写入所有压缩条目到压缩主题的问题 [21917](https://github.com/apache/pulsar/pull/21917)
- **修复**：修复跳过不可恢复账本时的死锁问题 [21915](https://github.com/apache/pulsar/pull/21915)
- **修复**：修复在配置了广告地址和广告监听器时无法确定领导Broker的问题 [21894](https://github.com/apache/pulsar/pull/21894)
- **修复**：修复由于PIP-145的错误导致无法使用后缀匹配正则表达式订阅分区主题的问题 [21885](https://github.com/apache/pulsar/pull/21885)
- **修复**：修复压缩/复制数据丢失问题 [21865](https://github.com/apache/pulsar/pull/21865)
- **修复**：修复NonPersistentDispatcherMultipleConsumers的ArrayIndexOutOfBoundsException [21856](https://github.com/apache/pulsar/pull/21856)
- **修复**：修复在同时设置webServicePort和webServicePortTls时返回错误的webServiceUrl [21842](https://github.com/apache/pulsar/pull/21842)
- **修复**：修复字符串格式错误 [21829](https://github.com/apache/pulsar/pull/21829)
- **修复**：尽可能多地更新主题策略，即使抛出异常 [21810](https://github.com/apache/pulsar/pull/21810)
- **修复**：修复TableViewLoadDataStoreImpl的NPE [21777](https://github.com/apache/pulsar/pull/21777)
- **修复**：修复BrokerService.maxUnackedMsgsPerDispatcher的错误值 [21765](https://github.com/apache/pulsar/pull/21765)
- **修复**：修复在领导权变更时ExtensibleLoadManagerImpl内部系统获取主题失败的问题 [21764](https://github.com/apache/pulsar/pull/21764)
- **修复**：删除主题时删除压缩账本 [21745](https://github.com/apache/pulsar/pull/21745)
- **修复**：为ExtensibleLoadManager内部主题跳过主题自动创建 [21729](https://github.com/apache/pulsar/pull/21729)
- **修复**：修复ServiceUnitStateChannel监视器仅标记不活动