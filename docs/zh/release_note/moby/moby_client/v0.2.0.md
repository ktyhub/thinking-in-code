# moby client/v0.2.0
### 为什么要使用Moby

在容器技术的狂潮中，每一位舵手都面临着一个核心矛盾：是选择一艘功能齐全但可能笨重的“豪华游轮”，还是跳上一艘轻便灵活却可能经不起风浪的“小帆板”？这就是现代开发与运维深处的抉择。而Moby，恰恰诞生于这个矛盾的交叉点。它并非要替代你熟悉的工具，而是提供了一个**开放的核心引擎**，让你能够亲自参与打造那艘“恰到好处”的船。使用Moby，意味着你不再是被动的乘客；你获得了在巨人的蓝图上进行创新的自由，可以为了极致的性能、无与伦比的安全性，或是特殊的硬件需求去定制每一个铆钉。它解决了“一刀切”的局限性，将控制权从厂商手中交还到开发者社区。当你需要超越标准解决方案，当你的场景独特而现有的容器平台显得臃肿或不足时，Moby就是你手中那张从“使用工具”到“创造工具”的船票。

### Moby是什么

简单来说，Moby 是一个开源项目，它为组装基于容器的系统提供了一个“乐高积木”式的工具箱。它是 Docker 引擎的核心组件库，将其模块化，允许开发者、企业或任何组织利用这些标准化组件来构建和定制专属的容器平台。你可以把它理解为 Docker 引擎的“上游”项目，是创新和实验的基石。

### 入门示例

**真实场景：** 假设你是一家物联网公司的架构师，需要为成千上万种不同配置的边缘设备部署轻量级监控代理。使用标准的、完整的容器引擎可能资源消耗过大，而你只需要其中关于容器运行、网络隔离和镜像管理的核心功能。

**开发示例：**
1.  **明确需求：** 你需要一个极简的运行时，只需支持特定的镜像格式和简单的网络模型。
2.  **利用Moby工具包：** 你可以从 Moby 项目中提取你需要的组件，例如 `containerd`（容器运行时）、`runc`（底层容器执行器）、以及特定的网络驱动模块。
3.  **组装与定制：** 使用像 `linuxkit` 这样的 Moby 子项目，通过一个 YAML 配置文件来描述你的系统。你可以选择只包含上述核心组件，并移除所有不必要的守护进程、包管理器和图形界面。
    ```yaml
    # 简化的 linuxkit 配置示例
    kernel:
      image: "linuxkit/kernel:5.10.x"
    init:
      - "linuxkit/init:v0.8"
      - "linuxkit/runc:v0.8"
    services:
      - name: containerd
        image: "linuxkit/containerd:v0.8"
      - name: my-monitor-agent
        image: "your-registry/monitor-agent:latest"
    files:
      - path: /etc/resolv.conf
        contents: "nameserver 8.8.8.8"
    ```
4.  **构建与部署：** 运行 `moby build` 命令，将上述配置构建成一个为你的场景量身定制的、精简的操作系统镜像（如 ISO、RAW 或虚拟机格式）。然后，这个镜像就可以被刷入到你的边缘设备中，形成一个高度专业化、安全且资源占用极小的容器主机。

### client/v0.2.0版本更新了什么

client/v0.2.0 版本主要聚焦于 API 版本管理的增强与规范化。它引入了 `MinAPIVersion` 常量来明确客户端支持的最低API版本，并优化了 `Ping` 功能以支持手动版本配置下的强制协商。此次更新将 API 版本协商设为默认行为，同时废弃了旧的 `WithVersion` 系列函数，统一并强化了 `WithAPIVersion` 系列函数的使用与验证，使版本控制更加清晰和健壮。

### 更新日志

#### client/v0.2.0

##### Bug修复与功能增强
*   新增 `MinAPIVersion` 常量，该常量包含了客户端所支持的最低 API 版本。
*   客户端 `Ping` 方法：允许在配置了手动版本的客户端上使用 `ForceNegotiate` 选项。
*   使 `WithAPIVersion` 和 `WithAPIVersionFromEnv` 函数的调用顺序无关，并验证其格式的正确性。

##### 网络
*   默认启用 API 版本协商，并弃用 `WithAPIVersionNegotiation` 函数。

##### 已弃用的功能
*   弃用 `WithVersion` 函数，推荐使用 `WithAPIVersion` 作为替代。
*   弃用 `WithVersionFromEnv` 函数，推荐使用 `WithAPIVersionFromEnv` 作为替代。

### 总结

综上所述，client/v0.2.0 版本的更新核心在于 **API 版本管理的标准化与简化**。它通过设定明确的最低版本支持、将版本协商变为默认行为、并统一命名废弃旧函数，使得客户端在对接不同版本的服务器时行为更加一致、可靠和易于维护。