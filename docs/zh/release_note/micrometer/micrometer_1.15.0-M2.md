# micrometer 1.15.0-M2
### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨micrometer

åœ¨ç°ä»£è½¯ä»¶å¼€å‘ä¸­ï¼Œæ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†å˜å¾—è‡³å…³é‡è¦ã€‚ç„¶è€Œï¼Œè®¸å¤šå¼€å‘è€…åœ¨é€‰æ‹©ç›‘æ§å·¥å…·æ—¶å¸¸å¸¸é¢ä¸´ä¸€ä¸ªçŸ›ç›¾ï¼šæ˜¯é€‰æ‹©ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä½†å¤æ‚çš„å·¥å…·ï¼Œè¿˜æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨ä½†åŠŸèƒ½æœ‰é™çš„å·¥å…·ï¼ŸMicrometeræ°å¥½å¡«è¡¥äº†è¿™ä¸ªç©ºç™½ã€‚å®ƒä¸ä»…æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œè¿˜èƒ½è½»æ¾é›†æˆåˆ°å„ç§åº”ç”¨ç¨‹åºä¸­ï¼Œè®©å¼€å‘è€…åœ¨ç›‘æ§æ€§èƒ½çš„åŒæ—¶ï¼Œä¿æŒä»£ç çš„ç®€æ´å’Œå¯ç»´æŠ¤æ€§ã€‚é€‰æ‹©Micrometerï¼Œæ„å‘³ç€ä½ å¯ä»¥åœ¨å¤æ‚çš„ç›‘æ§éœ€æ±‚å’Œç®€å•çš„å®ç°ä¹‹é—´æ‰¾åˆ°å®Œç¾çš„å¹³è¡¡ã€‚

### micrometeræ˜¯ä»€ä¹ˆ

Micrometeræ˜¯ä¸€ä¸ªç”¨äºåº”ç”¨ç¨‹åºæ€§èƒ½ç›‘æ§çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„APIæ¥æ”¶é›†å’ŒæŠ¥å‘ŠæŒ‡æ ‡ã€‚å®ƒæ”¯æŒå¤šç§ç›‘æ§ç³»ç»Ÿï¼Œå¦‚Prometheusã€Graphiteå’ŒInfluxDBï¼Œå…è®¸å¼€å‘è€…è½»æ¾åœ°å°†åº”ç”¨ç¨‹åºçš„æ€§èƒ½æ•°æ®å‘é€åˆ°è¿™äº›ç³»ç»Ÿä¸­è¿›è¡Œåˆ†æå’Œå¯è§†åŒ–ã€‚é€šè¿‡Micrometerï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°ç†è§£åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

### å…¥é—¨ç¤ºä¾‹

å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œå¸Œæœ›ç›‘æ§ç”¨æˆ·çš„è´­ä¹°è¡Œä¸ºã€‚ä½¿ç”¨Micrometerï¼Œä½ å¯ä»¥è½»æ¾åœ°åœ¨ä»£ç ä¸­æ·»åŠ è®¡æ—¶å™¨æ¥è®°å½•æ¯ä¸ªè´­ä¹°è¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š

```java
import io.micrometer.core.instrument.MeterRegistry;
import io.micrometer.core.instrument.Timer;

public class PurchaseService {
    private final MeterRegistry meterRegistry;

    public PurchaseService(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
    }

    public void purchaseItem(String itemId) {
        Timer timer = meterRegistry.timer("purchase.time");
        timer.record(() -> {
            // æ¨¡æ‹Ÿè´­ä¹°é€»è¾‘
            processPurchase(itemId);
        });
    }

    private void processPurchase(String itemId) {
        // å¤„ç†è´­ä¹°é€»è¾‘
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`purchase.time`è®¡æ—¶å™¨ä¼šè®°å½•æ¯æ¬¡è´­ä¹°æ“ä½œçš„å¤„ç†æ—¶é—´ï¼Œå¸®åŠ©ä½ åˆ†æå’Œä¼˜åŒ–è´­ä¹°æµç¨‹çš„æ€§èƒ½ã€‚

### micrometer 1.15.0-M2ç‰ˆæœ¬æ›´æ–°äº†ä»€ä¹ˆ

Micrometer 1.15.0-M2ç‰ˆæœ¬å¸¦æ¥äº†å‡ ä¸ªé‡è¦æ›´æ–°ï¼ŒåŒ…æ‹¬å°†é‡Œç¨‹ç¢‘å‘å¸ƒåˆ°Maven Centralã€ç§»é™¤å¯¹404/301çŠ¶æ€çš„ç‰¹æ®Šå¤„ç†ã€ä»¥åŠå¼ƒç”¨micrometer-registry-signalfxã€‚æ­¤å¤–ï¼Œæ–°å¢äº†ç›´æ¥è°ƒç”¨equalsæ–¹æ³•çš„åŠŸèƒ½ï¼Œæ”¹è¿›äº†Timerå’ŒLongTaskTimeråœ¨LoggingMeterRegistryä¸­çš„è¾“å‡ºæ ¼å¼ã€‚

### æ›´æ–°æ—¥å¿—

## âš ï¸ é‡è¦äº‹é¡¹
- å°†é‡Œç¨‹ç¢‘å‘å¸ƒåˆ°Maven Centralã€‚
- ç§»é™¤OkHttpä»ªå™¨ä¸­çš„404/301çŠ¶æ€çš„ç‰¹æ®Šå¤„ç†ã€‚
- å¼ƒç”¨micrometer-registry-signalfxã€‚

## â­ æ–°ç‰¹æ€§ / å¢å¼º
- ä½¿ç”¨ç›´æ¥çš„equalsè°ƒç”¨æ›¿ä»£Objects.equalsåŒ…è£…ã€‚
- ç§»é™¤JDK HTTPå®¢æˆ·ç«¯ä»ªå™¨ä¸­çš„404/301çŠ¶æ€çš„ç‰¹æ®Šå¤„ç†ã€‚
- åœ¨LoggingMeterRegistryä¸­ä½¿Timerå’ŒLongTaskTimerçš„è¾“å‡ºæ ¼å¼ç›¸ä¼¼ã€‚
- ç§»é™¤Jettyå®¢æˆ·ç«¯ä»ªå™¨ä¸­çš„404å’Œé‡å®šå‘çŠ¶æ€çš„ç‰¹æ®Šå¤„ç†ã€‚
- åˆ›å»ºSignalFxMeterRegistryæ—¶è®°å½•å¼ƒç”¨è­¦å‘Šã€‚
- åœ¨CountedAspectå’ŒTimedAspectä¸­è®°å½•æŒ‡æ ‡å½•åˆ¶å¤±è´¥ã€‚
- æ”¯æŒExecutorServiceMetricsä¸­çš„AutoShutdownDelegatedExecutorServiceã€‚
- å½“è°ƒç”¨LoggerContext#reconfigureæ—¶é‡æ–°ç»‘å®šLog4j2Metricsã€‚
- é€šè¿‡OTLPæ³¨å†Œè¡¨ä»¥ä»»ä½•åè®®å‘é€æŒ‡æ ‡ã€‚
- æ”¹è¿›DefaultLongTaskTimeråœ¨æ— åºåœæ­¢æ—¶çš„å¹³å‡æ€§èƒ½ã€‚

## ğŸ é”™è¯¯ä¿®å¤
- ä¿®å¤Log4j2Metricsåœ¨å¤šä¸ªæ³¨å†Œè¡¨å’Œéæ ¹è®°å½•å™¨ä¸­æ— æ³•æ­£å¸¸å·¥ä½œçš„é—®é¢˜ã€‚
- ä¿®å¤LoggingMeterRegistryä¸­LongTaskTimerè¾“å‡ºçš„é—®é¢˜ã€‚
- ä¿®å¤LoggingMeterRegistryä¸­Timerå’ŒFunctionTimerä¹‹é—´çš„å•ä½ä¸ä¸€è‡´é—®é¢˜ã€‚
- ä¿®å¤Distribution bucket_countsæ€»å’Œä¸ç­‰äºè®¡æ•°çš„é—®é¢˜ã€‚

## ğŸ“” æ–‡æ¡£
- ä»Stackdriveræ–‡æ¡£ä¸­ç§»é™¤è¿‡æ—¶çš„GraalVMåŸç”Ÿé•œåƒç¼–è¯‘éƒ¨åˆ†ã€‚
- æ›´æ–°æ–‡æ¡£ä»¥æ­£ç¡®æè¿°MeterFilterçš„åˆåŒã€‚

## ğŸ”¨ ä¾èµ–å‡çº§
- å°†com.google.auth:google-auth-library-oauth2-httpä»1.30.1å‡çº§åˆ°1.32.1ã€‚
- å°†software.amazon.awssdk:cloudwatchä»2.29.46å‡çº§åˆ°2.30.15ã€‚
- å°†com.netflix.spectator:spectator-reg-atlasä»1.8.3å‡çº§åˆ°1.8.4ã€‚
- å°†com.signalfx.public:signalfx-javaä»1.0.47å‡çº§åˆ°1.0.49ã€‚
- å°†org.apache.httpcomponents.client5:httpclient5ä»5.4.1å‡çº§åˆ°5.4.2ã€‚

## ğŸ“ ä»»åŠ¡
- æ·»åŠ æµ‹è¯•ä»¥éªŒè¯Apache (Async) HTTPå®¢æˆ·ç«¯æ²¡æœ‰å¯¹404çš„ç‰¹æ®Šå¤„ç†ã€‚
- å°†æ„å»ºJDKå‡çº§åˆ°23.0.2ã€‚
- ä¿®å¤JDK17+çš„gradle checké—®é¢˜ã€‚

### æ€»ç»“

Micrometer 1.15.0-M2ç‰ˆæœ¬çš„æ›´æ–°ä¸ä»…ä¿®å¤äº†å¤šä¸ªé”™è¯¯ï¼Œè¿˜å¼•å…¥äº†æ–°çš„ç‰¹æ€§å’Œå¢å¼ºåŠŸèƒ½ï¼Œæå‡äº†æ€§èƒ½ç›‘æ§çš„çµæ´»æ€§å’Œå‡†ç¡®æ€§ã€‚è¿™äº›æ”¹è¿›å°†å¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°é›†æˆå’Œä½¿ç”¨Micrometerï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ç›‘æ§ã€‚